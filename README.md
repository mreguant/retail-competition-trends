# Code and data repository for "Smart Meters and Retail Competition: Trends and Challenges"
Authors: Mar Reguant, Jacint Enrich, Ruoyi Li, and Alejandro Mizrahi

Description
--------
This repository replicates the results for the paper "Smart Meters and Retail Competition: Trends and Challenges". The code is written in Julia. The file "main_windows" or "main_macOS" runs all of the code to generate the data for the 2 figures and 2 tables in the paper. Because price data are confidential, this repository replicates the results without them. 

Data Availability and Provenance Statements
----------------------------

- [ ] This paper does not involve analysis of external data (i.e., no data are used or the only data are generated by the authors via simulation in their code).

> If box above is checked and if no simulated/synthetic data files are provided by the authors, please skip directly to the section on [Computational Requirements]. Otherwise, continue.

### Statement about Rights

- [x] I certify that the author(s) of the manuscript have legitimate access to and permission to use the data used in this manuscript. 

### Summary of Availability

- [ ] All data **are** publicly available.
- [x] Some data **cannot be made** publicly available.
- [ ] **No data can be made** publicly available.

### Details on each Data Source

### Market share data
> Data on market share were downloaded from CNMC's 2019 Electricity Retail Market Monitoring Report (https://www.cnmc.es/expedientes/isde02720). Data are available from Q1 2011 to Q4 2019. 

Datafiles: `consumer_data.csv`, `traditional_retailers_list.csv`.

### Flow data 
> Data on consumers' flow were digitalised from CNMCâ€™s Quarterly Monitoring Reports on Changes of Retailer (https://www.cnmc.es/expedientes?t=IS+SOBRE+CAMBIOS+DE+COMERCIALIZADOR&idambito=All&edit-submit-buscador-expedientes=Buscar&idtipoexp=All&hidprocedim=All). Data are available from Q1 2016 to Q3 2020. 

Datafile: `flow_data.csv`.

### Price data 
> Historical data on retail electricity prices were provided by the CNMC and are confidential. 


### Smart meter data
> Data on smart meter's adoption were digitalised from CNMC's Equipment Integrated in the Remote Management System Reports (https://www.cnmc.es/expedientes?t=TELEGESTION&idambito=All&edit-submit-buscador-expedientes=Buscar&idtipoexp=All&hidprocedim=All). Data are available from July 2015 to December 2019.  

Datafile: `smart_meter.csv`.


Dataset list
------------

| Data file | Source | Notes    |Provided |
|-----------|--------|----------|---------|
| `build/input/consumer_data.csv` | CNMC | Quarterly market share data at the market level | Yes |
| `build/input/traditional_retailers_list.csv` | Own elaboration | Used to relate each retailer to its corresponding group | Yes |
| `build/input/flow_data.csv` | CNMC | Quarterly registrations, dropouts and switchings of consumers | Yes |
| `build/input/smart_meter.csv`| CNMC | Quarterly share of supply points with smart meters at the market level| Yes |


Computational requirements
---------------------------

### Software Requirements

- Julia (code was last run with version 1.6.2)
  - `CSV` v0.9.11
  - `DataFrames` v0.22.7
  - `StringEncodings` v0.3.5
  - `Dates` v1.7.1
  - `ShiftedArrays` v1.0.0
  - `Plots` v1.23.6
  - `FixedEffectModels` v1.6.3
  - `CategoricalArrays` v0.9.7
  - `RegressionTables` v0.5.3
  - `JuMP` v0.21.10
  - `Ipopt` v0.7.0
  - `DataStructures` v0.18.11
  - `Printf`
  - `Plots`
- The code "`0_setup.jl`" will install all dependencies. It should be run once.


### Controlled Randomness

- [ ] Random seed is set at line _____ of program ______

### Memory and Runtime Requirements

#### Summary

Approximate time needed to reproduce the analyses on a standard 2022 desktop machine:

- [] <10 minutes
- [x] 10-60 minutes
- [ ] 1-8 hours
- [ ] 8-24 hours
- [ ] 1-3 days
- [ ] 3-14 days
- [ ] > 14 days
- [ ] Not feasible to run on a desktop machine, as described below.

#### Details

The code was last run on a **11th Gen Intel(R) Core(TM) i5-1135G with Windows 10 Pro**. 


Description of programs/code
----------------------------

- The code `0_setup.jl` installs all required dependencies in Julia.
- The code `build/code/1_create_data_sets.jl` computes the market shares based on the number of supply points in each market and tariff, and combines market shares with smart meter data.
- The code `analysis/code/2_analysis.jl` computes the calibration and regression in table 1 and 2b. 
- The code `analysis/code/3_plots.jl` will generate the figures 1a and 2a.

Instructions to Replicators
---------------------------

- Run `0_setup.jl` once to install the required packages. 
- Run `main_windows.bat` (for Windows users) or `main_macOS.sh` (for MAC OS users) to generate all the outputs sequencially. To run Julia from the command line, add Julia to the PATH environment variable. See https://julialang.org/downloads/platform. 

List of tables and programs
---------------------------

The provided code reproduces:

- [ ] All numbers provided in text in the paper
- [ ] All tables and figures in the paper
- [x] Selected tables and figures in the paper, as explained and justified below.


| Figure/Table #    | Program                         | Line Number | Output file                      |
|-------------------|---------------------------------|-------------|----------------------------------|
| Table 1           | analysis/code/2_analysis.jl     | 324         | table_1.tex                      |
| Table 2b          | analysis/code/2_analysis.jl     | 382         | figure_2b.tex                    |
| Figure 1a         | analysis/code/3_plots.jl        | 42          | figure_1a.png                    |  
| Figure 2a         | analysis/code/3_plots.jl        | 180         | figure_2a.png                    | 
